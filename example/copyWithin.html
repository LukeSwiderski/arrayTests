<script src="../simpleTest.js"></script>

<script>

function copyWithin(array, target, start, end) {
  var storageArray = [];

  for (var i = 0; i < array.length; i++) {//populates the storage array with the same amount of items as the original.
    storageArray.push(undefined);
    delete storageArray[i];
  }

  var storageIndexBegin = 0;
  var storageIndexEnd = array.length;

  if (start) {
    storageIndexBegin = start;
    if (start < 0) {
      storageIndexBegin = start + array.length;
    }
  }
  if (end) {
    storageIndexEnd = end;
  }

  for (var i = storageIndexBegin; i < storageIndexEnd; i++) {//populates the storage array with copied sequence, puts them in the same indices they were in original array.
    if (i in array) {
      storageArray[i] = array[i];
    }else {
      delete storageArray[i];
    }
  }
  var storageArrayIndex = 0;
  if (start) {
    storageArrayIndex = start;
    if (start < 0) {
      storageArrayIndex = start + array.length;
    }
  }

  if (target < 0) {
    target += array.length;
  }
  var originalArrayIndex = target;
  var whenToEnd = storageIndexEnd - storageIndexBegin + target;

  for (var i = target; i < whenToEnd; i++) {//populates original array with copied item(s)
    if (storageArrayIndex in storageArray) {
      array[originalArrayIndex] = storageArray[storageArrayIndex];
    }else {
      delete array[originalArrayIndex];
    }
    storageArrayIndex++;
    originalArrayIndex++;
  }
  return array;
}

tests({

  'It should return an array.': function () {
    var testArray = [1];
    var result = copyWithin(testArray);
    eq(Array.isArray(result), true);
  },

  'It should copy a sequence from the array, to a specified position in the same array.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 0, 2, 4);
    eq(testArray[0], 3);
    eq(testArray[1], 4);
    eq(testArray[2], 3);
    eq(testArray[3], 4);
  },

  'It should not change the length of the array.': function () {
    var testArray = [1, 2, 3, 4];
    var result = copyWithin(testArray, 0, 1, 3);
    eq(testArray.length, 4);
  },

  'It should return the modified array.': function () {
    var testArray = [1, 2, 3, 4];
    var modifiedArray = copyWithin(testArray, 0, 1, 3);
    eq(testArray, modifiedArray);
  },

  'If negative, target should be counted from the end.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, -2, 1, 3);
    eq(testArray[0], 1);
    eq(testArray[1], 2);
    eq(testArray[2], 2);
    eq(testArray[3], 3);
  },

  'If target is greater than or equal to arr.length, it should not copy anything.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 5, 0, 3);
    eq(testArray[0], 1);
    eq(testArray[1], 2);
    eq(testArray[2], 3);
    eq(testArray[3], 4);
  },

  'If target is positioned after start, the copied sequence will be trimmed to fit arr.length.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 1, 0, 4);
    eq(testArray[0], 1);
    eq(testArray[1], 1);
    eq(testArray[2], 2);
    eq(testArray[3], 3);
  },

  'If given a start value, it should start from that position.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 1, 0, 4);
    eq(testArray[1], 1);
  },

  'If negative, start should be counted from the end.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 1, -4, 4);
    eq(testArray[1], 1);
  },

  'If start is omitted, it should copy from index 0.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 2);
    eq(testArray[0], 1);
    eq(testArray[1], 2);
    eq(testArray[2], 1);
    eq(testArray[3], 2);
  },

  'If end value, it should copy up to but not including the end value.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 0, 1, 3);
    eq(testArray[0], 2);
    eq(testArray[1], 3);
    eq(testArray[2], 3);
    eq(testArray[3], 4);
  },

  'If negative, end should be counted from the end of the array.': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 0, 1, -2);
    eq(testArray[1], 2);
  },

  'If end is omitted, it should copy until the end of the array.':  function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 0, 1);
    eq(testArray[0], 2);
    eq(testArray[1], 3);
    eq(testArray[2], 4);
    eq(testArray[3], 4);
  },

  'If no start or end, it should copy index 0 to end and put that sequence at target until it runs out of space': function () {
    var testArray = [1, 2, 3, 4];
    copyWithin(testArray, 2);
    eq(testArray[0], 1);
    eq(testArray[1], 2);
    eq(testArray[2], 1);
    eq(testArray[3], 2);
  },

  'It should not skip holes in the array': function () {
    var testArray = [, 2, , ,];
    copyWithin(testArray, 0, 1, 3);
    eq(0 in testArray, true);
    eq(1 in testArray, false);
    eq(2 in testArray, false);
    eq(3 in testArray, false);
  }
});
</script>
